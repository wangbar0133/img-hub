# ImgHub å›¾ç‰‡ç®¡ç†è„šæœ¬

æœ¬ç›®å½•åŒ…å«ä¸¤ä¸ªç‰ˆæœ¬çš„å›¾ç‰‡ç®¡ç†å·¥å…·ï¼š

## ğŸ Python ç‰ˆæœ¬ï¼ˆæ¨èï¼‰

**æ–‡ä»¶ï¼š** `img-manager.py`

### ä¼˜åŠ¿
- âœ… æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒ
- âœ… ç±»å‹æç¤ºå’Œä»£ç å¯è¯»æ€§
- âœ… åŸç”Ÿ JSON å¤„ç†ï¼Œæ— éœ€é¢å¤–å·¥å…·
- âœ… è·¨å¹³å°å…¼å®¹æ€§æ›´å¥½
- âœ… é¢å‘å¯¹è±¡è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
- â­ **åŸå›¾æ— æŸä¿å­˜**ï¼šå®Œå…¨ä¸å‹ç¼©ï¼Œä¿æŒ100%åŸå§‹è´¨é‡

### ä½¿ç”¨æ–¹æ³•
```bash
# æŸ¥çœ‹å¸®åŠ©
python3 scripts/img-manager.py help

# æœ¬åœ°æµ‹è¯•æ¨¡å¼
python3 scripts/img-manager.py local-test

# æŸ¥çœ‹æ•°æ®çŠ¶æ€
python3 scripts/img-manager.py status

# å¯åŠ¨æœ¬åœ°é¢„è§ˆ
python3 scripts/img-manager.py local-preview
```

### ä¾èµ–è¦æ±‚
- Python 3.6+
- ImageMagick (`convert`, `identify`)
- ExifTool (`exiftool`)

```bash
# macOS å®‰è£…ä¾èµ–
brew install imagemagick exiftool

# Ubuntu å®‰è£…ä¾èµ–
sudo apt install imagemagick libimage-exiftool-perl
```

## ğŸ”§ Bash ç‰ˆæœ¬ï¼ˆå…¼å®¹æ€§ï¼‰

**æ–‡ä»¶ï¼š** `img-manager.sh`

### ç‰¹ç‚¹
- âœ… ä¼ ç»Ÿ Shell è„šæœ¬ï¼Œå…¼å®¹æ€§å¥½
- âœ… åŠŸèƒ½å®Œæ•´ï¼Œç»è¿‡éªŒè¯
- âš ï¸ ä¾èµ– `jq` å¤„ç† JSON
- âš ï¸ é”™è¯¯å¤„ç†ç›¸å¯¹ç®€å•

### ä½¿ç”¨æ–¹æ³•
```bash
# æœ¬åœ°æµ‹è¯•æ¨¡å¼
./scripts/img-manager.sh local-test

# æŸ¥çœ‹æ•°æ®çŠ¶æ€
./scripts/img-manager.sh status
```

### ä¾èµ–è¦æ±‚
- Bash 4.0+
- ImageMagick
- jq
- rsync
- exiftool

## ğŸ“‹ åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | Pythonç‰ˆæœ¬ | Bashç‰ˆæœ¬ |
|------|-----------|----------|
| å›¾ç‰‡å¤„ç† | âœ… | âœ… |
| EXIFæå– | âœ… | âœ… |
| JSONç®¡ç† | âœ… åŸç”Ÿ | âœ… ä¾èµ–jq |
| é”™è¯¯å¤„ç† | âœ… å¼ºå¤§ | âš ï¸ åŸºç¡€ |
| è·¨å¹³å° | âœ… å¥½ | âš ï¸ ä¸€èˆ¬ |
| ç±»å‹å®‰å…¨ | âœ… | âŒ |
| ä»£ç ç»´æŠ¤ | âœ… æ˜“ | âš ï¸ ä¸­ç­‰ |
| åŸå›¾å¤„ç† | â­ æ— æŸä¿å­˜ | âš ï¸ å‹ç¼©95% |

## ğŸš€ è¿ç§»å»ºè®®

å»ºè®®ä» Bash ç‰ˆæœ¬è¿ç§»åˆ° Python ç‰ˆæœ¬ï¼š

1. **ä¿æŒæ•°æ®å…¼å®¹** - ä¸¤ä¸ªç‰ˆæœ¬ä½¿ç”¨ç›¸åŒçš„æ•°æ®æ ¼å¼
2. **é€æ­¥è¿ç§»** - å¯ä»¥å¹¶è¡Œä½¿ç”¨ä¸¤ä¸ªç‰ˆæœ¬
3. **æµ‹è¯•éªŒè¯** - åœ¨æœ¬åœ°å……åˆ†æµ‹è¯•åå†åˆ‡æ¢

## ğŸ–¼ï¸ åŸå›¾å¤„ç†è¯´æ˜

Pythonç‰ˆæœ¬é»˜è®¤å¯¹åŸå›¾é‡‡ç”¨**æ— æŸä¿å­˜**ç­–ç•¥ï¼š

### é»˜è®¤è¡Œä¸ºï¼ˆæ¨èï¼‰
- âœ… **å®Œå…¨ä¸å‹ç¼©**ï¼šåŸå›¾ä½¿ç”¨ `shutil.copy2()` ç›´æ¥å¤åˆ¶
- âœ… **ä¿æŒåŸå§‹è´¨é‡**ï¼š100% æ— æŸï¼ŒåŒ…æ‹¬EXIFæ•°æ®
- âœ… **ä¿æŒåŸå§‹å°ºå¯¸**ï¼šä¸é™åˆ¶å›¾ç‰‡å¤§å°
- âœ… **ä¿æŒåŸå§‹æ ¼å¼**ï¼šJPG/PNG/WebPç­‰æ ¼å¼å®Œå…¨ä¿æŒ

### éªŒè¯æ–¹æ³•
```bash
# å¤„ç†å‰åæ–‡ä»¶å¤§å°å¯¹æ¯”
ls -lh /path/to/original/image.jpg
ls -lh ./public/images/original/category_timestamp.jpg

# åº”è¯¥çœ‹åˆ°æ–‡ä»¶å¤§å°å®Œå…¨ç›¸åŒ
```

### é«˜çº§é…ç½®ï¼ˆå¯é€‰ï¼‰
å¦‚æœç¡®å®éœ€è¦å‹ç¼©åŸå›¾ï¼ˆä¸æ¨èï¼‰ï¼Œå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰é…ç½®ï¼š

```python
# ä¿®æ”¹ scripts/img-config-example.py
self.compress_original = True      # å¯ç”¨åŸå›¾å‹ç¼©
self.original_max_size = 3000      # æœ€å¤§å°ºå¯¸
self.original_quality = 98         # å‹ç¼©è´¨é‡
```

## ğŸ’¡ æ‰©å±•åŠŸèƒ½

Python ç‰ˆæœ¬ä¸ºæœªæ¥æ‰©å±•æä¾›äº†æ›´å¥½çš„åŸºç¡€ï¼š

- ğŸ”„ æ‰¹é‡æ“ä½œä¼˜åŒ–
- ğŸ¨ å›¾ç‰‡æ»¤é•œå’Œç‰¹æ•ˆ
- ğŸ“Š æ›´è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯
- ğŸŒ Web API é›†æˆ
- ğŸ” å›¾ç‰‡ç›¸ä¼¼åº¦æ£€æµ‹
- ğŸ“± ç§»åŠ¨ç«¯é€‚é…æ£€æµ‹ 

## ğŸ”„ æ•°æ®ç®¡ç†æµç¨‹

### æ–°çš„ç®€åŒ–æµç¨‹ï¼ˆv3.1.0+ï¼‰

1. **æ•°æ®å­˜å‚¨ä½ç½®**ï¼š`public/albums.json`
2. **DockeræŒ‚è½½**ï¼šæ•´ä¸ª `public` ç›®å½•
3. **è‡ªåŠ¨åŒæ­¥**ï¼šä¸Šä¼ å›¾ç‰‡æ—¶ç›´æ¥æ›´æ–°DockeræŒ‚è½½çš„æ•°æ®

```bash
# 1. æœ¬åœ°å¤„ç†å›¾ç‰‡
python3 scripts/img-manager.py local-test

# 2. Dockerè‡ªåŠ¨ä½¿ç”¨æœ€æ–°æ•°æ®ï¼ˆæ— éœ€æ‰‹åŠ¨åŒæ­¥ï¼‰
docker-compose up -d

# 3. æ•°æ®ä¸€è‡´æ€§ï¼šæœ¬åœ° = å®¹å™¨ = æœåŠ¡å™¨
```

### ä¼˜åŠ¿
- âœ… **æ•°æ®ä¸€è‡´æ€§**ï¼šæœ¬åœ°å’Œè¿œç¨‹å§‹ç»ˆåŒæ­¥
- âœ… **ç®€åŒ–éƒ¨ç½²**ï¼šæ— éœ€å•ç‹¬åŒæ­¥JSONæ–‡ä»¶
- âœ… **å®æ—¶æ›´æ–°**ï¼šå›¾ç‰‡ä¸Šä¼ åç«‹å³ç”Ÿæ•ˆ
- âœ… **å‡å°‘é”™è¯¯**ï¼šé¿å…æ‰‹åŠ¨Gitæäº¤é—æ¼

### DockeræŒ‚è½½é…ç½®
```yaml
volumes:
  # æŒ‚è½½æ•´ä¸ªpublicç›®å½•ï¼ŒåŒ…å«imageså’Œalbums.json
  - ./public:/usr/share/nginx/html/public:ro
```

## ğŸ³ Docker é•œåƒä¼˜åŒ–

### æ•°æ®åˆ†ç¦»ç­–ç•¥

**é—®é¢˜**ï¼šä¼ ç»Ÿæ–¹å¼ä¼šå°†æœ¬åœ°å›¾ç‰‡æ‰“åŒ…åˆ°é•œåƒä¸­ï¼Œå¯¼è‡´ï¼š
- âŒ é•œåƒä½“ç§¯å·¨å¤§ï¼ˆGBçº§åˆ«ï¼‰
- âŒ å†…ç½®æ–‡ä»¶ä¸æŒ‚è½½æ–‡ä»¶å†²çª
- âŒ æ¯æ¬¡æ›´æ–°å›¾ç‰‡éœ€è¦é‡å»ºé•œåƒ

**è§£å†³æ–¹æ¡ˆ**ï¼šæ•°æ®ä¸åº”ç”¨å®Œå…¨åˆ†ç¦»
- âœ… **`.dockerignore`**ï¼šæ’é™¤ `public/images/` å’Œ `public/albums.json`
- âœ… **Dockerfile**ï¼šæ„å»ºæ—¶æ¸…ç©ºpublicç›®å½•ï¼Œåªä¿ç•™ç©ºçš„ç›®å½•ç»“æ„
- âœ… **æŒ‚è½½è¦†ç›–**ï¼šè¿è¡Œæ—¶æŒ‚è½½çœŸå®æ•°æ®è¦†ç›–ç©ºç›®å½•

### æ„å»ºè¿‡ç¨‹è¯¦è§£

```dockerfile
# ç¬¬ä¸€é˜¶æ®µï¼šæ„å»ºNext.jsåº”ç”¨
FROM node:18-alpine AS builder
COPY . .                    # å¤åˆ¶æºç ï¼ˆexcludes: public/images/, public/albums.jsonï¼‰
RUN npm run build          # ç”Ÿæˆé™æ€æ–‡ä»¶åˆ° /app/out

# ç¬¬äºŒé˜¶æ®µï¼šç”Ÿäº§é•œåƒ
FROM nginx:alpine
COPY --from=builder /app/out /usr/share/nginx/html

# ğŸ§¹ å…³é”®æ­¥éª¤ï¼šæ¸…ç†publicç›®å½•
RUN rm -rf /usr/share/nginx/html/public/* && \
    mkdir -p /usr/share/nginx/html/public/images/{travel,cosplay,detail,original} && \
    mkdir -p /usr/share/nginx/html/public/images/thumbnails/{travel,cosplay} && \
    echo "[]" > /usr/share/nginx/html/public/albums.json
```

### éªŒè¯é•œåƒæ¸…æ´æ€§

```bash
# æ„å»ºé•œåƒ
docker build -t img-hub-clean .

# æ£€æŸ¥é•œåƒå¤§å°ï¼ˆåº”è¯¥å¾ˆå°ï¼‰
docker images img-hub-clean

# æ£€æŸ¥publicç›®å½•ï¼ˆåº”è¯¥ä¸ºç©ºç»“æ„ï¼‰
docker run --rm img-hub-clean ls -la /usr/share/nginx/html/public/

# å¯åŠ¨å®¹å™¨å¹¶æŒ‚è½½æ•°æ®
docker-compose up -d

# éªŒè¯æŒ‚è½½åæœ‰æ•°æ®
docker exec img-hub-app ls -la /usr/share/nginx/html/public/
```

### ä¼˜åŠ¿å¯¹æ¯”

| æ–¹æ¡ˆ | é•œåƒå¤§å° | æ›´æ–°æ–¹å¼ | æ•°æ®ä¸€è‡´æ€§ | æ„å»ºæ—¶é—´ |
|------|----------|----------|------------|----------|
| **ä¼ ç»Ÿæ–¹å¼** | 1-5GB+ | é‡å»ºé•œåƒ | âŒ å¯èƒ½å†²çª | 5-10åˆ†é’Ÿ |
| **åˆ†ç¦»æ–¹å¼** | 50-100MB | ä»…æŒ‚è½½ | âœ… å®Œå…¨åŒæ­¥ | 1-2åˆ†é’Ÿ | 